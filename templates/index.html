<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Chatbot Spotify</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { margin:0; font-family: 'Montserrat', sans-serif; background:#121212; color:#fff; display:flex; height:100vh; }
        #sidebar { width:220px; background:#000; padding:20px; display:flex; flex-direction:column; gap:25px; }
        #sidebar img { width:120px; margin-bottom:20px; filter:invert(1); }
        .menu-item { font-size:18px; cursor:pointer; color:#b3b3b3; transition:0.2s; }
        .menu-item:hover { color:#fff; }
        #chatWrap { flex:1; padding:30px; display:flex; flex-direction:column; }
        h2 { color:#1DB954; font-size:28px; margin:0 0 20px 0; }
        #messages { flex:1; padding:15px; background:#181818; border-radius:10px; overflow-y:auto; border:1px solid #333; }
        .msg { margin:12px 0; padding:12px 18px; border-radius:15px; max-width:75%; display:flex; gap:10px; align-items:flex-start; animation:fadeIn 0.25s ease; }
        @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
        .user { background:#1DB954; color:#000; margin-left:auto; flex-direction:row-reverse; }
        .bot { background:#333; }
        .avatar { width:40px; height:40px; border-radius:50%; object-fit:cover; }
        #inputContainer { display:flex; margin-top:20px; }
        #input { flex:1; padding:15px; background:#282828; border:1px solid #333; color:#fff; border-radius:10px 0 0 10px; outline:none; font-size:16px; }
        #sendBtn { background:#1DB954; padding:0 25px; border:none; border-radius:0 10px 10px 0; cursor:pointer; color:#000; font-weight:bold; font-size:16px; }
        #typing { color:#1DB954; font-size:14px; margin:10px 0; display:none; animation:fadeIn 0.3s; }
        @media (max-width:700px) { #sidebar{display:none;} body{flex-direction:column;} }
    </style>
</head>

<body>

    <div id="sidebar">
        <img src="https://upload.wikimedia.org/wikipedia/commons/1/19/Spotify_logo_without_text.svg">
        <div class="menu-item">ğŸ  Home</div>
        <div class="menu-item">ğŸ” Buscar</div>
        <div class="menu-item">ğŸµ Suas Playlists</div>
    </div>

    <div id="chatWrap">
        <h2>Chatbot Spotify</h2>

        <div id="messages"></div>
        <div id="typing">Bot estÃ¡ digitando...</div>

        <div id="inputContainer">
            <input id="input" placeholder="Digite uma mensagem...">
            <button id="sendBtn" onclick="sendMessage()">Enviar</button>
        </div>
    </div>

<script>

function addMessage(who, text) {
    const div = document.getElementById("messages");
    const msg = document.createElement("div");
    msg.className = "msg " + who;

    const avatar = document.createElement("img");
    avatar.className = "avatar";
    avatar.src = who === "user"
        ? "{{ url_for('static', filename='avatars/user.png') }}"
        : "{{ url_for('static', filename='avatars/chatbot.png') }}";

    const p = document.createElement("span");
    p.innerHTML = text.replace(/\n/g, "<br>");

    msg.appendChild(avatar);
    msg.appendChild(p);

    div.appendChild(msg);
    div.scrollTop = div.scrollHeight;
}

async function sendMessage() {
    const input = document.getElementById("input");
    const text = input.value.trim();
    if (!text) return;

    addMessage("user", text);
    input.value = "";

    const typing = document.getElementById("typing");
    typing.style.display = "block";

    const resp = await fetch("/api/message", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({message: text})
    });

    const data = await resp.json();
    setTimeout(() => {
        typing.style.display = "none";
        addMessage("bot", data.reply);
    }, 600);
}

document.getElementById("sendBtn").onclick = sendMessage;
document.getElementById("input").addEventListener("keydown", (e) => {
    if (e.key === "Enter") sendMessage();
});

document.getElementById("homeBtn").onclick = () => {
    document.getElementById("messages").innerHTML = "";
    addMessage("bot", "ğŸ  VocÃª estÃ¡ na Home!<br><br>Posso te ajudar com:<br>âœ” criar playlist<br>âœ” adicionar mÃºsica<br>âœ” remover mÃºsica<br>âœ” buscar mÃºsica<br>âœ” mostrar playlists");
};

document.getElementById("searchBtn").onclick = () => {
    addMessage("bot", "ğŸ” O que deseja buscar? Digite algo como:<br><b>buscar love</b><br><b>buscar rock</b>");
};

document.getElementById("playlistsBtn").onclick = async () => {
    const resp = await fetch("/api/message", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({message: "mostrar playlists"})
    });
    const data = await resp.json();
    addMessage("bot", data.reply);
};

window.onload = () => {
    setTimeout(() => {
        document.getElementById("typing").style.display = "block";
    }, 300);

    setTimeout(() => {
        document.getElementById("typing").style.display = "none";
        addMessage(
            "bot",
            "OlÃ¡! ğŸ‘‹<br><br>Eu entendo comandos como:<br>" +
            "ğŸµ <b>buscar X</b><br>" +
            "ğŸ“€ <b>criar playlist X</b><br>" +
            "â• <b>adicionar Y na playlist X</b><br>" +
            "âŒ <b>remover Y da playlist X</b><br>" +
            "ğŸ“‹ <b>mostrar playlists</b><br><br>" +
            "Me diga o que deseja fazer! ğŸ˜„"
        );
    }, 1500);
};
</script>


</body>
</html>
